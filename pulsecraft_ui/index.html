<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulseCraft: The Consciousness Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="enhancement.css">
    <link rel="stylesheet" href="shapeshifter.css">
    <link rel="stylesheet" href="progressive.css"> 
    <!-- Include jsPDF library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Font Awesome for loading spinner icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Global Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p class="loading-text">Reflecting truth...</p>
    </div>

    <div class="container" data-phase="1">
        <!-- PHASE 1: THE MIRROR - Always visible -->
        <div class="phase phase-1 active">
            <h1 class="main-title">PulseCraft</h1>
            <p class="tagline">"Most tools give you templates. This one gives you yourself."</p>
            
            <div class="section mirror-section">
                <h2>Mirror Your Voice</h2>
                <p class="mirror-instruction">Enter your authentic expression below. A mission statement, a heartfelt email, a piece of your truth.</p>
                <textarea id="brandVoiceInput" rows="6" placeholder="Share your clearest signal..."></textarea>
                <button class="btn-primary mirror-button" id="mirrorVoiceButton">
                    <span class="mirror-icon"></span><span class="btn-text">Mirror My Voice</span>
                </button>
            </div>
        </div>

        <!-- PHASE 2: THE RECOGNITION - Revealed after first mirror -->
        <div class="phase phase-2 hidden">
            <div class="section recognition-section">
                <h2>Your Voice Revealed</h2>
                <div id="mirroredVoiceOutput" class="voice-reflection-output">
                    <div class="voice-attribute" data-attribute="tone">
                        <strong>Tone:</strong>
                        <span id="outputTone">Awaiting reflection...</span>
                    </div>
                    <div class="voice-attribute" data-attribute="vocabulary">
                        <strong>Vocabulary:</strong>
                        <span id="outputVocabulary">Awaiting reflection...</span>
                    </div>
                    <div class="voice-attribute" data-attribute="archetype">
                        <strong>Archetype:</strong>
                        <span id="outputArchetype">Awaiting reflection...</span>
                    </div>
                    <div class="voice-attribute" data-attribute="phrasing">
                        <strong>Phrasing Style:</strong>
                        <span id="outputPhrasingStyle">Awaiting reflection...</span>
                    </div>
                    <div class="voice-attribute" data-attribute="samples">
                        <strong>Sample Phrases:</strong>
                        <span id="outputSamplePhrases">Awaiting reflection...</span>
                    </div>
                    <div class="voice-attribute" data-attribute="avoid">
                        <strong>Phrases to Avoid:</strong>
                        <span id="outputPhrasesToAvoid">Awaiting reflection...</span>
                    </div>
                </div>
            </div>

            <!-- DNA and Symbol Memory -->
            <div class="section dna-section">
                <div class="dna-container">
                    <h3>DNA TAGS</h3>
                    <p>Your voice's unique essence markers</p>
                    <div id="dnaTagsContainer" class="tag-container">
                        <p class="placeholder-text">Your DNA tags will crystallize here...</p>
                    </div>
                </div>
                
                <div class="symbol-container">
                    <h3>SYMBOL ANCHORS</h3>
                    <p>Deeper resonance points of your expression</p>
                    <div id="symbolAnchorsContainer" class="tag-container">
                        <p class="placeholder-text">Your symbol anchors will emerge here...</p>
                    </div>
                </div>
            </div>

            <!-- Save Controls -->
            <div class="section save-section">
                <h3>Crystallize This Frequency</h3>
                <input type="text" id="brandNameInput" placeholder="Name this voice signature...">
                <button class="btn-primary" id="saveToMemoryButton">Save Voice Kit</button>
                <p class="save-hint">Save your voice to unlock content generation capabilities</p>
            </div>
        </div>

        <!-- PHASE 3: THE EXPANSION - Revealed after first save -->
        <div class="phase phase-3 hidden">
            <!-- Content Generation -->
            <div class="section expansion-section full-width">
                <h2>Express Through Your Voice</h2>
                <p>Now that we know your voice, let's use it to create.</p>
                
                <div class="tab-buttons">
                    <button class="tab-button" data-style="storyBasedSelling">Story</button>
                    <button class="tab-button" data-style="aboutPage">About</button>
                    <button class="tab-button" data-style="manifestoOriginVoice">Manifesto</button>
                    <button class="tab-button" data-style="insightTone">Insight</button>
                    <button class="tab-button" data-style="founderLetter">Letter</button>
                </div>
                
                <div id="stylePreviewOutput" class="tab-content">
                    <p class="tab-placeholder">Select a style above to see your voice in action</p>
                </div>
                
                <div class="generation-controls">
                    <h3>Create Custom Content</h3>
                    <textarea id="contentGenerationInput" rows="3" placeholder="What do you want to express?"></textarea>
                    <button class="btn-primary" id="writeItForMeButton">Generate Content</button>
                </div>
                
                <div id="generatedContentOutput" class="generated-output">
                    <p class="output-placeholder">Your generated content will appear here...</p>
                </div>
            </div>

            <!-- Voice Library Preview -->
            <div class="section library-preview">
                <h3>Your Voice Library</h3>
                <select id="sessionSelect">
                    <option value="" selected disabled>Select a saved voice</option>
                </select>
                <button class="btn-secondary" id="recallButton">Recall Voice</button>
            </div>
        </div>

        <!-- PHASE 4: THE ALCHEMY - Revealed after multiple saves -->
        <div class="phase phase-4 hidden">
            <!-- Advanced Features -->
            <div class="section alchemy-section full-width">
                <h2>Voice Alchemy</h2>
                <p>Combine multiple voice signatures to discover emergent frequencies.</p>
                
                <div id="previewGalleryGrid" class="collective-preview-gallery">
                    <!-- Voice kit cards will be dynamically inserted here -->
                </div>
                
                <button class="btn-secondary" id="refineKitsButton">Alchemize Selected Voices</button>
            </div>

            <!-- Export/Import Tools -->
            <div class="section tools-section">
                <h3>Voice Data Tools</h3>
                <div class="button-group">
                    <button class="btn-export-json" id="exportAllKitsJSONButton">Export Library</button>
                    <button class="btn-export-pdf" id="exportPDFButton">Export Report</button>
                    <button class="btn-export-txt" id="exportTXTButton">Export Summary</button>
                </div>
                
                <div class="import-section">
                    <input type="file" id="importMemoryFile" accept=".json" class="hidden-file-input">
                    <button class="btn-secondary" id="uploadMemoryBridgeButton">Import Memory Bridge</button>
                </div>
            </div>
        </div>

        <!-- Footer - Always visible but subtle -->
        <footer class="phase-footer">
            <p id="footerText">Begin your journey...</p>
        </footer>
    </div>

    <!-- Hidden sections for backward compatibility -->
    <div style="display: none;">
        <div id="yourPastSignalsContent"></div>
        <button id="exportCurrentVoiceJSONButton"></button>
        <button id="exportSymbolicMemoryButton"></button>
        <button id="clearAllSavedKitsButton"></button>
        <select id="contentGenerationStyleSelect">
            <option value="general">General</option>
        </select>
    </div>

    <!-- Welcome Banner -->
    <div id="welcomeBanner" class="hidden"></div>
 
    <!-- CRITICAL FIX: Correct script loading order -->
    <!-- 1. Load shapeshifter first (creates interface system) -->
    <script src="shapeshifter.js"></script>
    
    <!-- 2. Load main script (defines mirrorVoice and other functions) -->
    <script src="Script.js"></script>
    
    <!-- 3. Load progressive system last (wraps existing functions) -->
    <script src="progressive.js"></script>
</body>
</html>