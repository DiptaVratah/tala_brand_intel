---
phase: 01-landing-page--navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pulsecraft_ui/router.js
  - pulsecraft_ui/landing.css
  - pulsecraft_ui/index.html
  - server.js
autonomous: true

must_haves:
  truths:
    - "User visiting root URL (/) sees landing page with tagline and 3 mode selection cards"
    - "User navigating to /branding, /author, or /self-reflection in browser does not see 404"
    - "User can use browser back/forward buttons after navigating between pages"
  artifacts:
    - path: "pulsecraft_ui/router.js"
      provides: "History API router with pushState and popstate handling"
      exports: ["PulseCraftRouter"]
      contains: ["window.pulsecraftRouter", "init()", "getCurrentPath()"]
      min_lines: 60
    - path: "pulsecraft_ui/landing.css"
      provides: "Landing page styling for mode cards and hero section"
      contains: ".landing-hero"
      min_lines: 100
    - path: "server.js"
      provides: "Wildcard route serving index.html for SPA paths"
      contains: "app.get('*'"
  key_links:
    - from: "server.js"
      to: "pulsecraft_ui/index.html"
      via: "wildcard route serving index.html for all non-API/non-static paths"
      pattern: "app\\.get\\('\\*'"
    - from: "pulsecraft_ui/router.js"
      to: "window.history"
      via: "pushState and popstate event listener"
      pattern: "history\\.pushState|popstate"
---

<objective>
Create landing page foundation with client-side router and server-side SPA support.

Purpose: Establish the infrastructure for professional landing page with clean URL routing. This is the foundation that Plan 02 will wire into the existing app.

Output: router.js module (class only, not initialized), landing page HTML/CSS structure, server wildcard route support.

Note: Plan 01 creates the router CLASS and HTML structure with data-path attributes. Plan 02 will wire the click handlers and initialize the router with route handlers.
</objective>

<execution_context>
@/Users/dipta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dipta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-landing-page--navigation/01-RESEARCH.md
@pulsecraft_ui/index.html
@pulsecraft_ui/style.css
@server.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create router.js with History API</name>
  <files>pulsecraft_ui/router.js</files>
  <action>
Create a vanilla JavaScript router class using the History API. Requirements:

1. Class `PulseCraftRouter` with methods:
   - `constructor(routes)` - accepts route config object
   - `init()` - sets up popstate listener and handles initial page load
   - `navigate(path, state)` - uses pushState to change URL and calls route handler
   - `route(path, state)` - looks up and executes route handler
   - `getCurrentPath()` - returns current pathname

2. Route config format:
   ```javascript
   {
     '/': () => showLanding(),
     '/branding': () => loadMode('branding'),
     '/author': () => loadMode('author'),
     '/self-reflection': () => loadMode('self-reflection'),
     '*': () => router.navigate('/') // fallback
   }
   ```

3. Key behaviors:
   - Listen for `popstate` event for browser back/forward
   - Handle initial page load by routing based on `window.location.pathname`
   - Expose as `window.pulsecraftRouter` for global access
   - DO NOT initialize routes yet - just expose the class (Plan 02 will wire it)

4. Include JSDoc comments for public methods.

Pattern from research:
```javascript
class PulseCraftRouter {
  constructor(routes = {}) {
    this.routes = new Map(Object.entries(routes));
    this.currentPath = window.location.pathname;
  }

  init() {
    window.addEventListener('popstate', (event) => {
      this.route(window.location.pathname, event.state);
    });

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        this.route(this.currentPath);
      });
    } else {
      this.route(this.currentPath);
    }
  }

  getCurrentPath() {
    return window.location.pathname;
  }
  // ... etc
}

// Expose class globally (Plan 02 will instantiate and initialize)
window.PulseCraftRouter = PulseCraftRouter;
```
  </action>
  <verify>
File exists and contains:
- `class PulseCraftRouter`
- `history.pushState` call
- `popstate` event listener
- `window.pulsecraftRouter` or `window.PulseCraftRouter` assignment
- `init()` method
- `getCurrentPath()` method

Run:
```bash
grep -E "(class PulseCraftRouter|pushState|popstate)" pulsecraft_ui/router.js
grep -E "(window\\.pulsecraftRouter|window\\.PulseCraftRouter|init\\(\\)|getCurrentPath\\(\\))" pulsecraft_ui/router.js
```
  </verify>
  <done>router.js exists with PulseCraftRouter class exposing navigate(), route(), init(), getCurrentPath() methods and popstate handling</done>
</task>

<task type="auto">
  <name>Task 2: Create landing page HTML structure and CSS</name>
  <files>pulsecraft_ui/index.html, pulsecraft_ui/landing.css</files>
  <action>
Modify index.html and create landing.css to add a professional landing page.

**index.html changes:**

1. Add link to landing.css in head section (after other CSS links):
   ```html
   <link rel="stylesheet" href="landing.css">
   ```

2. Add router.js script BEFORE shapeshifter.js at bottom of body:
   ```html
   <script src="router.js"></script>
   <script src="shapeshifter.js"></script>
   ```

3. Add NEW landing section as FIRST child of `.container`, BEFORE phase-1:
   ```html
   <div class="landing-view" id="landingView">
     <section class="landing-hero">
       <h1 class="landing-title">PulseCraft</h1>
       <p class="landing-tagline">Most tools give you templates. This one gives you yourself.</p>
     </section>

     <section class="mode-selection">
       <h2 class="mode-selection-title">Choose Your Path</h2>
       <div class="mode-cards">
         <article class="mode-card" data-mode="branding">
           <div class="mode-card-icon">
             <i class="fas fa-bullseye"></i>
           </div>
           <h3 class="mode-card-title">Branding</h3>
           <p class="mode-card-description">Build a consistent brand voice that resonates with your audience</p>
           <button class="mode-card-button" data-path="/branding">Start Building</button>
         </article>

         <article class="mode-card" data-mode="author">
           <div class="mode-card-icon">
             <i class="fas fa-feather-pointed"></i>
           </div>
           <h3 class="mode-card-title">Author</h3>
           <p class="mode-card-description">Discover and refine your unique writing voice</p>
           <button class="mode-card-button" data-path="/author">Start Writing</button>
         </article>

         <article class="mode-card" data-mode="self-reflection">
           <div class="mode-card-icon">
             <i class="fas fa-seedling"></i>
           </div>
           <h3 class="mode-card-title">Self-Reflection</h3>
           <p class="mode-card-description">Understand yourself through the patterns in your words</p>
           <button class="mode-card-button" data-path="/self-reflection">Start Exploring</button>
         </article>
       </div>
     </section>
   </div>
   ```

4. Wrap existing phases in a new div for app view (but do NOT change phase structure):
   Add `id="appView"` and class `app-view hidden` to a wrapper around phases 1-5.

   IMPORTANT: Do NOT remove or restructure existing phase divs. Just wrap them:
   ```html
   <div class="app-view hidden" id="appView">
     <div class="phase phase-1 active">...</div>
     <div class="phase phase-2 hidden">...</div>
     <!-- etc -->
   </div>
   ```

**IMPORTANT: Landing page must have exactly 3 mode cards:**
- Branding
- Author
- Self-Reflection

Do NOT include Consciousness Mode or Deep Mode cards (removed per UI-01).

**landing.css content:**

Create professional 2026 SaaS landing page styles:

1. Landing view:
   - Full viewport height with centered content
   - Clean white/light background
   - Minimal, no navigation bar

2. Hero section:
   - Large centered title (2.5-3rem)
   - Tagline in accent color (use CSS variables from style.css)
   - Generous whitespace

3. Mode cards:
   - 3-column grid on desktop, single column on mobile
   - Card hover effects (lift, shadow, border color change)
   - Icons using FontAwesome (already loaded)
   - Distinct button for each card

4. Responsive breakpoints:
   - Mobile: single column cards
   - Tablet: 2 columns
   - Desktop: 3 columns

5. App view toggle:
   - `.app-view.hidden { display: none; }`
   - `.landing-view.hidden { display: none; }`

Use existing CSS variables from style.css for colors (--color-accent-primary-green, etc.)

NOTE: This task creates HTML structure with data-path attributes on buttons. Plan 02 Task 1 will wire the click handlers.
  </action>
  <verify>
1. index.html contains landing-view div with mode cards
2. landing.css exists with .landing-hero, .mode-card, .mode-cards classes
3. Both landing-view and app-view divs exist
4. Exactly 3 mode cards (Branding, Author, Self-Reflection)

Run:
```bash
grep -q "landing-view" pulsecraft_ui/index.html && echo "landing-view found" || echo "MISSING"
grep -q "app-view" pulsecraft_ui/index.html && echo "app-view found" || echo "MISSING"
grep -q ".mode-card" pulsecraft_ui/landing.css && echo "mode-card CSS found" || echo "MISSING"
# Verify exactly 3 mode cards (not 5)
grep -c 'class="mode-card"' pulsecraft_ui/index.html | grep -q "^3$" && echo "3 mode cards found" || echo "ERROR: Expected 3 mode cards"
```
  </verify>
  <done>Landing page HTML structure exists with exactly 3 mode cards (Branding, Author, Self-Reflection), landing.css provides professional styling, app-view wrapper contains existing phases</done>
</task>

<task type="auto">
  <name>Task 3: Add server-side wildcard route for SPA</name>
  <files>server.js</files>
  <action>
Update server.js to serve index.html for all non-API, non-static-file paths. This enables direct URL access (e.g., pasting /branding into browser).

**Changes to server.js:**

1. Find the existing static file serving and root route:
   ```javascript
   app.use(express.static(path.join(__dirname, 'pulsecraft_ui')));
   app.get('/', (req, res) => {
     res.sendFile(path.join(__dirname, 'pulsecraft_ui', 'index.html'));
   });
   ```

2. REPLACE the `app.get('/', ...)` with a wildcard route that:
   - Serves index.html for all GET requests
   - EXCEPT paths starting with `/api/` (API routes)
   - EXCEPT paths that look like static files (contain a dot in the filename)

3. Add this AFTER the static middleware but BEFORE the API routes:
   ```javascript
   // SPA fallback - serve index.html for all non-API, non-static paths
   // This enables clean URL routing (e.g., /branding, /author, /self-reflection)
   app.get('*', (req, res, next) => {
     // Skip API routes
     if (req.path.startsWith('/api/')) {
       return next();
     }
     // Skip static files (paths with file extensions)
     if (req.path.includes('.')) {
       return next();
     }
     // Serve index.html for all other paths (SPA routing)
     res.sendFile(path.join(__dirname, 'pulsecraft_ui', 'index.html'));
   });
   ```

4. IMPORTANT: Place this route in the correct position:
   - AFTER: `app.use(express.static(...))`
   - BEFORE: All `/api/*` route definitions

This ensures:
- Static files (CSS, JS, images) still work
- API routes still work
- Direct URL access to /branding, /author, /self-reflection works
- Browser refresh on any route works
  </action>
  <verify>
1. server.js contains wildcard route `app.get('*', ...)`
2. Route checks for `/api/` prefix
3. Route serves index.html

Run:
```bash
grep -A5 "app.get('\*'" server.js | head -10
```

Manual test after server restart:
- `curl -s http://localhost:3000/branding | head -5` should return HTML (not 404)
  </verify>
  <done>Server serves index.html for /branding, /author, /self-reflection paths without 404, API routes still work</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **File structure check:**
   ```bash
   ls -la pulsecraft_ui/router.js pulsecraft_ui/landing.css
   ```

2. **HTML structure check:**
   ```bash
   grep -c "landing-view\|app-view\|mode-card" pulsecraft_ui/index.html
   ```

3. **Exactly 3 mode cards check:**
   ```bash
   grep -c 'class="mode-card"' pulsecraft_ui/index.html
   # Should output: 3
   ```

4. **Server route check:**
   ```bash
   grep "app.get('\*'" server.js
   ```

5. **Visual check (requires server running):**
   - Visit http://localhost:3000/ - should show landing page with 3 cards
   - Visit http://localhost:3000/branding - should NOT show 404 (routing wired in Plan 02)
</verification>

<success_criteria>
- [ ] router.js exists with PulseCraftRouter class, init(), getCurrentPath(), and History API integration
- [ ] landing.css exists with professional mode card styling
- [ ] index.html has landing-view section with exactly 3 mode cards (Branding, Author, Self-Reflection)
- [ ] index.html has app-view wrapper around existing phases
- [ ] server.js has wildcard route serving index.html for SPA paths
- [ ] No existing functionality broken (phases, API routes, static files)
</success_criteria>

<output>
After completion, create `.planning/phases/01-landing-page--navigation/01-01-SUMMARY.md`
</output>
