---
phase: 02-interface-differentiation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pulsecraft_ui/style.css
  - pulsecraft_ui/shapeshifter.js
  - pulsecraft_ui/index.html
autonomous: true

must_haves:
  truths:
    - "CSS custom properties change when data-mode attribute changes"
    - "Branding mode shows blue accents"
    - "Author mode shows red accents"
    - "Self-Reflection mode shows green accents"
    - "Consciousness Mode and Deep Mode are not visible in UI"
  artifacts:
    - path: "pulsecraft_ui/style.css"
      provides: "Mode-scoped CSS custom properties"
      contains: "[data-mode=\"branding\"]"
    - path: "pulsecraft_ui/shapeshifter.js"
      provides: "data-mode attribute setter"
      contains: "document.documentElement.setAttribute('data-mode'"
  key_links:
    - from: "shapeshifter.js setMode()"
      to: "document.documentElement"
      via: "setAttribute('data-mode')"
      pattern: "setAttribute\\(['\"]data-mode['\"]"
---

<objective>
Establish CSS theme foundation with mode-scoped custom properties and clean up deprecated modes.

Purpose: Create the theming infrastructure that all subsequent mode differentiation depends on. The data-mode attribute on document root enables CSS to respond to mode changes without JavaScript style manipulation.

Output: CSS theme variables scoped by data-mode attribute, shapeshifter updates to set data-mode, and removal of Consciousness/Deep mode visibility from UI.
</objective>

<execution_context>
@/Users/dipta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dipta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-interface-differentiation/02-CONTEXT.md
@.planning/phases/02-interface-differentiation/02-RESEARCH.md
@pulsecraft_ui/style.css
@pulsecraft_ui/shapeshifter.js
@pulsecraft_ui/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mode-scoped CSS custom properties</name>
  <files>pulsecraft_ui/style.css</files>
  <action>
Add mode-scoped CSS custom properties at the top of style.css (after the existing :root block). Define accent colors for each mode:

```css
/* Mode-specific accent colors */
[data-mode="branding"] {
  --accent-primary: #3b82f6;
  --accent-hover: #2563eb;
  --accent-glow: rgba(59, 130, 246, 0.3);
  --accent-text: #60a5fa;
}

[data-mode="author"] {
  --accent-primary: #ef4444;
  --accent-hover: #dc2626;
  --accent-glow: rgba(239, 68, 68, 0.3);
  --accent-text: #f87171;
}

[data-mode="therapy"] {
  --accent-primary: #10b981;
  --accent-hover: #059669;
  --accent-glow: rgba(16, 185, 129, 0.3);
  --accent-text: #34d399;
}
```

Also add fallback values in :root that map to the existing color scheme:

```css
:root {
  /* ... existing variables ... */

  /* Mode accent fallbacks (used when no data-mode set) */
  --accent-primary: var(--color-accent-secondary-blue);
  --accent-hover: var(--color-accent-secondary-blue-hover);
  --accent-glow: rgba(52, 152, 219, 0.3);
  --accent-text: var(--color-accent-secondary-blue);
}
```

Update .btn-primary to use the new accent variables:

```css
.btn-primary {
  background-color: var(--accent-primary, var(--color-accent-primary-green));
}
.btn-primary:hover {
  background-color: var(--accent-hover, var(--color-accent-primary-green-hover));
}
```

WHY: CSS custom properties scoped by data attribute are more performant than JavaScript style injection and enable smooth transitions.
  </action>
  <verify>
Open browser DevTools, manually set `document.documentElement.setAttribute('data-mode', 'branding')` in console. Verify buttons change to blue. Repeat for 'author' (red) and 'therapy' (green).
  </verify>
  <done>
CSS responds to data-mode attribute changes with correct accent colors for all three modes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update shapeshifter to set data-mode attribute</name>
  <files>pulsecraft_ui/shapeshifter.js</files>
  <action>
In the `applyMode()` method of InterfaceShapeshifter class, add data-mode attribute setting on document root:

```javascript
applyMode() {
    console.log('shapeshifter.js: Applying mode:', this.mode);

    const lang = this.LANGUAGE_MATRIX[this.mode];
    const colors = this.COLOR_SCHEMES[this.mode];

    // Apply CSS class to body (keep for backward compatibility)
    document.body.className = `${this.mode}-mode`;

    // NEW: Apply data-mode attribute for CSS scoping
    document.documentElement.setAttribute('data-mode', this.mode);

    // ... rest of existing code ...
}
```

Also update the `setMode()` method to ensure data-mode is set when mode changes:

```javascript
setMode(mode) {
    if (!mode || !this.MODES[mode]) {
        console.warn('shapeshifter.js: Invalid mode:', mode);
        return;
    }

    // Map self-reflection path to therapy mode
    if (mode === 'self-reflection') {
        mode = 'therapy';
    }

    this.mode = mode;

    // Set data-mode attribute immediately (before full applyMode)
    document.documentElement.setAttribute('data-mode', mode);

    this.applyMode();
    // ... rest of existing code ...
}
```

WHY: Setting data-mode on documentElement (html tag) allows CSS rules like `[data-mode="branding"] .btn-primary` to work throughout the page.
  </action>
  <verify>
Navigate to /branding, open DevTools Elements panel, confirm `<html data-mode="branding">`. Navigate to /author, confirm `<html data-mode="author">`. Navigate to /self-reflection, confirm `<html data-mode="therapy">`.
  </verify>
  <done>
data-mode attribute is set on html element matching current mode for all three interfaces.
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove Consciousness and Deep modes from visible UI</name>
  <files>pulsecraft_ui/shapeshifter.js, pulsecraft_ui/index.html</files>
  <action>
In shapeshifter.js, update the mode switcher dropdown to only show the three main modes. Modify `setupModeSwitcher()`:

```javascript
setupModeSwitcher() {
    // Don't show mode switcher on landing page
    if (this.mode === null) return;

    let switcher = document.getElementById('modeSwitcher');
    if (!switcher) {
        switcher = document.createElement('div');
        switcher.id = 'modeSwitcher';
        switcher.className = 'mode-switcher';
        // UPDATED: Only show three main modes (removed consciousness and deep)
        switcher.innerHTML = `
            <label for="modeSelect" style="font-size: 12px; color: #94a3b8; margin-bottom: 4px; display: block;">Interface Mode:</label>
            <select id="modeSelect">
                <option value="branding">Branding</option>
                <option value="author">Author</option>
                <option value="therapy">Self-Reflection</option>
            </select>
        `;
        document.body.appendChild(switcher);
    }
    // ... rest of existing code ...
}
```

Keep the MODES object and LANGUAGE_MATRIX entries for consciousness/deep (they're still used internally for easter eggs), but they won't appear in the UI.

In index.html, verify the landing page only has three mode cards (branding, author, self-reflection). The current HTML already looks correct - no consciousness or deep cards exist on landing page.

WHY: Success criteria SC-6 requires "User no longer sees Consciousness Mode or Deep Mode in any interface." The easter egg can still exist for advanced users but shouldn't be in normal navigation.
  </action>
  <verify>
1. Navigate to /branding, check mode switcher dropdown - should only show Branding, Author, Self-Reflection options
2. Navigate to landing page, verify only three mode cards are visible
3. Confirm Konami code still activates deep mode (easter egg preserved)
  </verify>
  <done>
Mode switcher shows only three modes, landing page has only three cards, easter egg still works.
  </done>
</task>

</tasks>

<verification>
1. Navigate to each mode URL (/branding, /author, /self-reflection)
2. Confirm correct accent color appears on primary buttons
3. Confirm data-mode attribute changes on html element
4. Confirm mode switcher only shows three options
5. Confirm landing page only shows three mode cards
</verification>

<success_criteria>
- CSS custom properties respond to data-mode attribute changes
- Branding mode displays blue accent colors (#3b82f6)
- Author mode displays red accent colors (#ef4444)
- Self-Reflection mode displays green accent colors (#10b981)
- Consciousness Mode and Deep Mode are not visible in mode switcher or landing page
- Easter egg (Konami code) still activates Deep Mode for advanced users
</success_criteria>

<output>
After completion, create `.planning/phases/02-interface-differentiation/02-01-SUMMARY.md`
</output>
